<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ–Ω—Ç–µ–Ω—Ç –ó–∞–≤–æ–¥ ‚Äî –î–∞—à–±–æ—Ä–¥</title>
    <style>
        :root { --bg: #0d0d0d; --card: #1a1a1a; --accent: #00ff88; --text: #ffffff; }
        body { font-family: sans-serif; background: var(--bg); color: var(--text); padding: 20px; }
        .container { max-width: 1100px; margin: 0 auto; }
        h1 { color: var(--accent); }
        #auth-screen { text-align: center; margin-top: 100px; }
        .auth-card { background: var(--card); padding: 40px; border-radius: 20px; border: 1px solid #333; display: inline-block; }
        input { background: #222; border: 1px solid #444; color: white; padding: 12px; border-radius: 8px; width: 300px; margin-bottom: 20px; }
        .btn { background: var(--accent); color: black; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: bold; }
        #dashboard { display: none; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 30px; }
        .card { background: var(--card); padding: 20px; border-radius: 15px; border: 1px solid #333; }
        .status { color: var(--accent); margin-bottom: 20px; }
        .error-log { background: #331111; color: #ff9999; padding: 15px; border-radius: 8px; font-size: 12px; margin-top: 20px; text-align: left; }
    </style>
</head>
<body>

<div class="container">
    <div id="auth-screen">
        <div class="auth-card">
            <h1>üè≠ –ö–æ–Ω—Ç–µ–Ω—Ç –ó–∞–≤–æ–¥</h1>
            <p>–í–≤–µ–¥–∏—Ç–µ API –∫–ª—é—á –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ Blotato</p>
            <input type="password" id="api-key" placeholder="blt_...">
            <br>
            <button class="btn" onclick="login()">–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ü–µ—Ö</button>
        </div>
    </div>

    <div id="dashboard">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h1>üè≠ –ö–æ–Ω—Ç–µ–Ω—Ç –ó–∞–≤–æ–¥ ‚Äî –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h1>
            <button onclick="logout()" style="background:none; border:none; color:#ff4444; cursor:pointer;">–í—ã–π—Ç–∏</button>
        </div>
        <div id="status" class="status">–û–∂–∏–¥–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...</div>
        <div id="stats-grid" class="grid"></div>
        <div id="debug-info"></div>
    </div>
</div>

<script>
    const storageKey = 'blotato_key_v2';

    window.onload = () => {
        const savedKey = localStorage.getItem(storageKey);
        if (savedKey) init(savedKey);
    };

    function login() {
        const key = document.getElementById('api-key').value.trim();
        if (key) { localStorage.setItem(storageKey, key); init(key); }
    }

    function logout() {
        localStorage.removeItem(storageKey);
        location.reload();
    }

    async function init(key) {
        document.getElementById('auth-screen').style.display = 'none';
        document.getElementById('dashboard').style.display = 'block';
        const status = document.getElementById('status');
        const grid = document.getElementById('stats-grid');
        const debug = document.getElementById('debug-info');

        status.innerText = "‚öôÔ∏è –ó–∞–ø—Ä–æ—Å –∫ API Blotato...";
        
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø—Ä–æ–∫—Å–∏ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
        const proxy = "https://corsproxy.io/?";
        const target = "https://api.blotato.com/v1/accounts";

        try {
            const response = await fetch(proxy + encodeURIComponent(target), {
                headers: { 'Authorization': `Bearer ${key}` }
            });

            if (!response.ok) throw new Error(`–û—à–∏–±–∫–∞: ${response.status} (–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–ª—é—á)`);

            const data = await response.json();
            
            if (!data || data.length === 0) {
                status.innerText = "‚ö†Ô∏è –ê–∫–∫–∞—É–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –î–æ–±–∞–≤—å—Ç–µ –∏—Ö –≤ —Ä–∞–∑–¥–µ–ª–µ Social Accounts –≤ Blotato.";
                return;
            }

            status.innerText = `‚úÖ –ù–∞–π–¥–µ–Ω–æ –∞–∫–∫–∞—É–Ω—Ç–æ–≤: ${data.length}`;
            grid.innerHTML = data.map(acc => `
                <div class="card">
                    <div style="color: #888; font-size: 12px;">${acc.platform?.toUpperCase() || 'PLATFORM'}</div>
                    <div style="font-size: 20px; font-weight: bold; margin: 10px 0;">${acc.username || '–ë–µ–∑ –∏–º–µ–Ω–∏'}</div>
                    <hr style="border: 0; border-top: 1px solid #333; margin: 15px 0;">
                    <div style="color: #888;">–í—Å–µ–≥–æ –≤–∏–¥–µ–æ: <b style="color: white;">${acc.total_posts || 0}</b></div>
                    <div style="color: #888; margin-top: 5px;">–ü—Ä–æ—Å–º–æ—Ç—Ä—ã: <b style="color: #00d4ff;">${acc.metrics?.views || '‚ö° 0'}</b></div>
                </div>
            `).join('');

        } catch (err) {
            status.innerText = "‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è";
            debug.innerHTML = `<div class="error-log"><b>–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:</b><br>${err.message}<br><br>1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–ª—é—á –≤ Blotato (Settings -> API keys).<br>2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –µ—Å—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.</div>`;
        }
    }
</script>
</body>
</html>
