
<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Blotato Dashboard</title>
<style>
body {background:#0b0f14;color:white;font-family:Arial;padding:30px}
input,button {padding:10px;border-radius:8px;border:none;font-size:16px}
button {background:#00ff88;font-weight:bold;cursor:pointer}
.card {background:#111;padding:20px;border-radius:14px;margin:15px 0}
.platform {color:#00ff88;font-weight:bold}
</style>
</head>
<body>

<h2>Blotato Dashboard</h2>

<input id="apiKey" placeholder="Введите API ключ" style="width:350px">
<button onclick="saveKey()">Сохранить</button>
<button onclick="logout()">Выйти</button>
<button onclick="loadAccounts()">Загрузить</button>

<div id="output"></div>

<script>
const webhookUrl = "https://nikolaenko-ds.ru/webhook/content-zavod";

function saveKey() {
  const key = document.getElementById("apiKey").value.trim();
  localStorage.setItem("blotato_key", key);
  alert("Ключ сохранён");
}

function logout() {
  localStorage.removeItem("blotato_key");
  document.getElementById("apiKey").value = "";
  document.getElementById("output").innerHTML = "";
}

window.onload = function() {
  const saved = localStorage.getItem("blotato_key");
  if (saved) {
    document.getElementById("apiKey").value = saved;
    loadAccounts();
  }
}

async function loadAccounts() {
  const key = (localStorage.getItem("blotato_key") || "").trim();
  if (!key) return alert("Введите API ключ");

  try {
    const res = await fetch(`${webhookUrl}?key=${encodeURIComponent(key)}`);
    const data = await res.json();

    if (!Array.isArray(data)) {
      document.getElementById("output").innerHTML =
        "<pre>"+JSON.stringify(data,null,2)+"</pre>";
      return;
    }

    document.getElementById("output").innerHTML = data.map(acc => `
      <div class="card">
        <div class="platform">${acc.platform}</div>
        <div><strong>${acc.name}</strong></div>
        ${acc.profile_url
            ? `<a href="${acc.profile_url}" target="_blank">ОТКРЫТЬ</a>`
            : (acc.search_url
                ? `<a href="${acc.search_url}" target="_blank">ПОИСК</a>`
                : `<span style="color:#777">НЕТ ССЫЛКИ</span>`)
        }
      </div>
    `).join("");
  } catch(e) {
    document.getElementById("output").innerHTML =
      "<pre>Ошибка: "+e.message+"</pre>";
  }
}
</script>

</body>
</html>
