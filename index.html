<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ–Ω—Ç–µ–Ω—Ç –ó–∞–≤–æ–¥ ‚Äî –î–∞—à–±–æ—Ä–¥</title>
    <style>
        :root { --bg: #0d0d0d; --card: #1a1a1a; --accent: #00ff88; --text: #ffffff; }
        body { font-family: sans-serif; background: var(--bg); color: var(--text); padding: 20px; }
        .container { max-width: 1100px; margin: 0 auto; }
        h1 { color: var(--accent); }
        #auth-screen { text-align: center; margin-top: 100px; }
        .auth-card { background: var(--card); padding: 40px; border-radius: 20px; border: 1px solid #333; display: inline-block; }
        input { background: #222; border: 1px solid #444; color: white; padding: 12px; border-radius: 8px; width: 300px; margin-bottom: 20px; outline: none; }
        input:focus { border-color: var(--accent); }
        .btn { background: var(--accent); color: black; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: bold; }
        #dashboard { display: none; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 30px; }
        .card { background: var(--card); padding: 20px; border-radius: 15px; border: 1px solid #333; transition: 0.3s; }
        .card:hover { border-color: var(--accent); }
        .status { color: var(--accent); margin-bottom: 20px; font-weight: bold; }
        .error-log { background: #331111; color: #ff9999; padding: 15px; border-radius: 8px; font-size: 13px; margin-top: 20px; border: 1px solid red; }
    </style>
</head>
<body>

<div class="container">
    <div id="auth-screen">
        <div class="auth-card">
            <h1>üè≠ –ö–æ–Ω—Ç–µ–Ω—Ç –ó–∞–≤–æ–¥</h1>
            <p>–í–≤–µ–¥–∏—Ç–µ API –∫–ª—é—á –∏–∑ Blotato (Settings > API keys)</p>
            <input type="password" id="api-key" placeholder="blt_...">
            <br>
            <button class="btn" onclick="login()">–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ</button>
        </div>
    </div>

    <div id="dashboard">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h1>üè≠ –ö–æ–Ω—Ç–µ–Ω—Ç –ó–∞–≤–æ–¥ ‚Äî –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h1>
            <button onclick="logout()" style="background:none; border:none; color:#ff4444; cursor:pointer; text-decoration: underline;">–°–º–µ–Ω–∏—Ç—å –∫–ª—é—á</button>
        </div>
        <div id="status" class="status">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</div>
        <div id="stats-grid" class="grid"></div>
        <div id="debug-info"></div>
    </div>
</div>

<script>
    const storageKey = 'blotato_factory_key';

    window.onload = () => {
        const savedKey = localStorage.getItem(storageKey);
        if (savedKey) init(savedKey);
    };

    function login() {
        const key = document.getElementById('api-key').value.trim();
        if (key.startsWith('blt_')) { 
            localStorage.setItem(storageKey, key); 
            init(key); 
        } else { 
            alert("–ö–ª—é—á –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å blt_"); 
        }
    }

    function logout() {
        localStorage.removeItem(storageKey);
        location.reload();
    }

    async function init(key) {
        document.getElementById('auth-screen').style.display = 'none';
        document.getElementById('dashboard').style.display = 'block';
        const status = document.getElementById('status');
        const grid = document.getElementById('stats-grid');
        const debug = document.getElementById('debug-info');

        status.innerText = "‚öôÔ∏è –°–≤—è–∑—å —Å —Å–µ—Ä–≤–µ—Ä–æ–º Blotato...";
        
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –ø—Ä–æ–∫—Å–∏
        const proxy = "https://api.allorigins.win/raw?url=";
        const target = "https://api.blotato.com/v1/accounts";

        try {
            const response = await fetch(proxy + encodeURIComponent(target), {
                headers: { 
                    'Authorization': `Bearer ${key}`,
                    'Accept': 'application/json'
                }
            });

            if (!response.ok) {
                const errText = await response.text();
                throw new Error(`–°–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—Ç–∏–ª: ${response.status}. ${errText.substring(0, 50)}`);
            }

            const data = await response.json();
            
            if (!data || (Array.isArray(data) && data.length === 0)) {
                status.innerText = "üîå –ê–∫–∫–∞—É–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ —Å–æ—Ü—Å–µ—Ç–∏ –≤ Blotato.";
                return;
            }

            status.innerText = `‚úÖ –¶–µ—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç. –ê–∫–∫–∞—É–Ω—Ç–æ–≤: ${Array.isArray(data) ? data.length : 1}`;
            
            const accounts = Array.isArray(data) ? data : [data];
            grid.innerHTML = accounts.map(acc => `
                <div class="card">
                    <div style="color: var(--accent); font-size: 11px; text-transform: uppercase;">${acc.platform || 'Social'}</div>
                    <div style="font-size: 20px; font-weight: bold; margin: 10px 0;">${acc.username || '–ê–∫–∫–∞—É–Ω—Ç'}</div>
                    <div style="color: #888; margin-top: 15px;">–í–∏–¥–µ–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ:</div>
                    <div style="font-size: 24px; font-weight: bold;">${acc.total_posts || 0}</div>
                    <div style="color: #888; margin-top: 10px;">–ü—Ä–æ—Å–º–æ—Ç—Ä—ã:</div>
                    <div style="font-size: 24px; font-weight: bold; color: #00d4ff;">${acc.metrics?.views || 0}</div>
                </div>
            `).join('');

        } catch (err) {
            status.innerText = "‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏";
            debug.innerHTML = `
                <div class="error-log">
                    <b>–û—à–∏–±–∫–∞ —Å–∏—Å—Ç–µ–º—ã:</b> ${err.message}<br><br>
                    <b>–ß—Ç–æ –¥–µ–ª–∞—Ç—å:</b><br>
                    1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª–∏ –∫–ª—é—á –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ <b>Settings -> API keys</b>.<br>
                    2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ Blotato –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∞–∫–∫–∞—É–Ω—Ç—ã –≤ —Ä–∞–∑–¥–µ–ª–µ <b>Social accounts</b>.<br>
                    3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –Ω–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "–°–º–µ–Ω–∏—Ç—å –∫–ª—é—á" –∏ –≤–≤–µ—Å—Ç–∏ –µ–≥–æ –∑–∞–Ω–æ–≤–æ.
                </div>`;
        }
    }
</script>
</body>
</html>
