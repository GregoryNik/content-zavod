<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ–Ω—Ç–µ–Ω—Ç –ó–∞–≤–æ–¥ ‚Äî –î–∞—à–±–æ—Ä–¥</title>
    <style>
        :root { --bg: #0d0d0d; --card: #1a1a1a; --accent: #00ff88; --text: #ffffff; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); color: var(--text); padding: 20px; }
        .container { max-width: 1100px; margin: 0 auto; }
        h1 { color: var(--accent); text-shadow: 0 0 10px rgba(0,255,136,0.3); }
        #auth-screen { text-align: center; margin-top: 100px; }
        .auth-card { background: var(--card); padding: 40px; border-radius: 20px; border: 1px solid #333; display: inline-block; }
        input { background: #222; border: 1px solid #444; color: white; padding: 12px; border-radius: 8px; width: 300px; margin-bottom: 20px; outline: none; }
        .btn { background: var(--accent); color: black; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn:hover { background: #00cc6e; transform: scale(1.02); }
        #dashboard { display: none; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 30px; }
        .card { background: var(--card); padding: 25px; border-radius: 15px; border: 1px solid #333; position: relative; overflow: hidden; }
        .card::before { content: ""; position: absolute; top: 0; left: 0; width: 4px; height: 100%; background: var(--accent); }
        .status { color: var(--accent); font-weight: bold; margin-bottom: 20px; }
        .error-log { background: #2a1111; color: #ff9999; padding: 20px; border-radius: 10px; border: 1px solid #551111; margin-top: 20px; line-height: 1.6; }
    </style>
</head>
<body>

<div class="container">
    <div id="auth-screen">
        <div class="auth-card">
            <h1>üè≠ –ö–æ–Ω—Ç–µ–Ω—Ç –ó–∞–≤–æ–¥</h1>
            <p style="color: #888;">–í–≤–µ–¥–∏—Ç–µ API –∫–ª—é—á (Settings > API keys)</p>
            <input type="password" id="api-key" placeholder="blt_...">
            <br>
            <button class="btn" onclick="login()">–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ</button>
        </div>
    </div>

    <div id="dashboard">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h1>üè≠ –ö–æ–Ω—Ç–µ–Ω—Ç –ó–∞–≤–æ–¥ ‚Äî –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h1>
            <button onclick="logout()" style="background:none; border:none; color:#ff4444; cursor:pointer; text-decoration: underline;">–°–º–µ–Ω–∏—Ç—å –∫–ª—é—á</button>
        </div>
        <div id="status" class="status">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</div>
        <div id="stats-grid" class="grid"></div>
        <div id="debug-info"></div>
    </div>
</div>

<script>
    const storageKey = 'blotato_factory_key_v3';

    window.onload = () => {
        const savedKey = localStorage.getItem(storageKey);
        if (savedKey) init(savedKey);
    };

    function login() {
        const key = document.getElementById('api-key').value.trim();
        if (key.startsWith('blt_')) { 
            localStorage.setItem(storageKey, key); 
            init(key); 
        } else { 
            alert("–ö–ª—é—á –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å blt_"); 
        }
    }

    function logout() {
        localStorage.removeItem(storageKey);
        location.reload();
    }

    async function init(key) {
        document.getElementById('auth-screen').style.display = 'none';
        document.getElementById('dashboard').style.display = 'block';
        const status = document.getElementById('status');
        const grid = document.getElementById('stats-grid');
        const debug = document.getElementById('debug-info');

        status.innerText = "‚öôÔ∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–Ω–∞–ª–æ–≤ —Å–≤—è–∑–∏ —Å Blotato...";
        
        // –ü–µ—Ä–µ–±–æ—Ä –≤–æ–∑–º–æ–∂–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
        const endpoints = [
            "https://api.blotato.com/v1/accounts",
            "https://api.blotato.com/v1/social-accounts",
            "https://api.blotato.com/v1/account"
        ];

        let success = false;
        let lastError = "";

        for (let url of endpoints) {
            if (success) break;
            
            try {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ–∫—Å–∏, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–≤–æ–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏ (allorigins —á–µ—Ä–µ–∑ raw)
                const finalUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`;
                
                const response = await fetch(finalUrl, {
                    method: 'GET',
                    headers: { 
                        'Authorization': `Bearer ${key}`,
                        'Accept': 'application/json'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    renderData(data);
                    success = true;
                    status.innerText = "‚úÖ –°–≤—è–∑—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞. –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã.";
                } else {
                    lastError = `–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${response.status}`;
                }
            } catch (err) {
                lastError = err.message;
            }
        }

        if (!success) {
            status.innerText = "‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏";
            debug.innerHTML = `
                <div class="error-log">
                    <b>–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ:</b> ${lastError}<br><br>
                    <b>–í–µ—Ä–æ—è—Ç–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:</b><br>
                    1. –í Blotato –Ω–µ —Å–æ–∑–¥–∞–Ω—ã API –∫–ª—é—á–∏ –∏–ª–∏ –æ–Ω–∏ –æ—Ç–æ–∑–≤–∞–Ω—ã[cite: 5].<br>
                    2. –í —Ä–∞–∑–¥–µ–ª–µ <b>Social accounts</b> –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∞–∫–∫–∞—É–Ω—Ç—ã (YouTube, TikTok –∏ –¥—Ä.)[cite: 5].<br>
                    3. –°–µ—Ä–≤–µ—Ä Blotato –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–∫—Å–∏.
                </div>`;
        }
    }

    function renderData(data) {
        const grid = document.getElementById('stats-grid');
        const accounts = Array.isArray(data) ? data : (data.accounts || [data]);
        
        if (accounts.length === 0) {
            document.getElementById('status').innerText = "üîå –ê–∫–∫–∞—É–Ω—Ç—ã –Ω–∞–π–¥–µ–Ω—ã, –Ω–æ —Å–ø–∏—Å–æ–∫ –ø—É—Å—Ç.";
            return;
        }

        grid.innerHTML = accounts.map(acc => `
            <div class="card">
                <div style="color: var(--accent); font-size: 11px; text-transform: uppercase; font-weight: bold;">
                    ${acc.platform || '–°–æ—Ü—Å–µ—Ç—å'}
                </div>
                <div style="font-size: 22px; font-weight: bold; margin: 10px 0;">${acc.username || '–ê–∫–∫–∞—É–Ω—Ç'}</div>
                
                <div style="margin-top: 20px;">
                    <div style="color: #888; font-size: 13px;">–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ –≤–∏–¥–µ–æ:</div>
                    <div style="font-size: 28px; font-weight: bold;">${acc.total_posts || acc.post_count || 0}</div>
                </div>

                <div style="margin-top: 15px;">
                    <div style="color: #888; font-size: 13px;">–ü—Ä–æ—Å–º–æ—Ç—Ä—ã (Viral AI Coach):</div>
                    <div style="font-size: 28px; font-weight: bold; color: #00d4ff;">
                        ${acc.metrics?.views || acc.total_views || '‚ö° 0'}
                    </div>
                </div>
            </div>
        `).join('');
    }
</script>
</body>
</html>
